"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var http_1 = require("@angular/common/http");
require("rxjs/add/operator/map");
var http_utils_1 = require("../shared/utils/http-utils");
var BankService = /** @class */ (function () {
    function BankService(httpClient) {
        this.httpClient = httpClient;
        // private baseUrl:string = "http://10.0.2.2:3000";
        // private baseUrl:string = "http://216.250.114.107:8080/StGeorgesBankServices";
        this.baseUrl = http_utils_1.HttpUtils.getWsUrl();
    }
    BankService.prototype.logoutUser = function (encrypteSec, ipAddr, razonSalida) {
        var url = this.baseUrl + "/LOGOUT_USER";
        var headers = http_utils_1.HttpUtils.createRequestHeaderPost();
        var formData = new FormData();
        formData.append('PSECUENCIA', encrypteSec);
        formData.append('PIP_ADD', ipAddr);
        formData.append('RAZON_SALIDA', razonSalida);
        //console.log("logoutUser:",url, "-", formData);
        return this.httpClient.post(url, formData, { headers: headers, responseType: "json" });
    };
    BankService.prototype.cambiarPassword = function (encryptedUsrPwdSec, indCambio, vigencia, hash) {
        var url = this.baseUrl + "/RESET_PASSWORD";
        var headers = http_utils_1.HttpUtils.createRequestHeaderPost();
        var formData = new FormData();
        formData.append('PUSER_PPASSNEW_PSECUENCIA', encryptedUsrPwdSec);
        formData.append('PIND_CAMBIO', indCambio);
        formData.append('PCADUCIDAD', vigencia);
        formData.append('PHASH', hash);
        console.log(url, "-", formData);
        return this.httpClient.post(url, formData, { headers: headers, responseType: "json" });
    };
    BankService.prototype.obtenerPwdVigencia = function () {
        var url = this.baseUrl + "/GET_DURACION_CLAVE";
        var headers = http_utils_1.HttpUtils.createRequestHeaderPost();
        var formData = new FormData();
        //console.log(url, "-", formData);
        return this.httpClient.post(url, formData, { headers: headers, responseType: "json" });
    };
    BankService.prototype.validarToken = function (secuencia, token, clienteEncriptado, ipDisp) {
        var url = this.baseUrl + "/VALIDATE_TOKEN";
        var headers = http_utils_1.HttpUtils.createRequestHeaderPost();
        var formData = new FormData();
        formData.append('PSECUENCIA', secuencia);
        formData.append('PTOKEN', token);
        formData.append('PUSER', clienteEncriptado);
        formData.append('PIP_ADD', ipDisp);
        //console.log(url, "-", formData);
        return this.httpClient.post(url, formData, { headers: headers, responseType: "json" });
    };
    // Se cre� nuevo servicio independiente 22/08/2018.
    // Cuando se cambie todo a ese nuevo servicio (mensaje.service.ts), se debe eliminar este m�todo.
    BankService.prototype.obtenerMensaje = function (codigo) {
        var url = this.baseUrl + "/GET_MENSAJE";
        var headers = http_utils_1.HttpUtils.createRequestHeaderPost();
        var formData = new FormData();
        formData.append('PRESP_COD', codigo);
        //console.log(url, "-", formData);
        return this.httpClient.post(url, formData, { headers: headers, responseType: "json" });
    };
    BankService.prototype.obtenerTipoCliente = function (encryptedUsrName) {
        var url = this.baseUrl + "/GET_TIPO_CLIENTE";
        var headers = http_utils_1.HttpUtils.createRequestHeaderPost();
        var formData = new FormData();
        formData.append('PUSER', encryptedUsrName);
        //console.log(url, "-", formData);
        return this.httpClient.post(url, formData, { headers: headers, responseType: "json" });
    };
    BankService.prototype.obtenerUsrImage = function (encryptedUsrName, modulus, exponent) {
        var url = this.baseUrl + "/GET_USER_IMAGE";
        var headers = http_utils_1.HttpUtils.createRequestHeaderPost();
        var formData = new FormData();
        formData.append('PUSER', encryptedUsrName);
        formData.append('PMODULUS', modulus);
        formData.append('PEXPONENT', exponent);
        console.log(url, "-", formData);
        return this.httpClient.post(url, formData, { headers: headers, responseType: "json" });
    };
    BankService.prototype.obtenerUsrImagen = function (encryptedUsrName, encryptedKeyAES) {
        var url = this.baseUrl + "/GET_USER_IMAGEN";
        var headers = http_utils_1.HttpUtils.createRequestHeaderPost();
        var formData = new FormData();
        formData.append('PUSER', encryptedUsrName);
        formData.append('PENVIO', encryptedKeyAES);
        console.log(url, "-", formData);
        return this.httpClient.post(url, formData, { headers: headers, responseType: "json" });
    };
    BankService.prototype.genPemPrivateKey = function (xmlPrivateKey) {
        var url = this.baseUrl + "/GEN_KEYS";
        var headers = http_utils_1.HttpUtils.createRequestHeaderPost();
        var formData = new FormData();
        formData.append('PK', xmlPrivateKey);
        console.log(url, "-", formData);
        return this.httpClient.post(url, formData, { headers: headers, responseType: "json" });
    };
    BankService.prototype.validarUsrLogin = function (encryptedNaP, ipDisp, dataDisp) {
        var url = this.baseUrl + "/VALIDATE_USER_PWD_LOGIN";
        var headers = http_utils_1.HttpUtils.createRequestHeaderPost();
        var formData = new FormData();
        formData.append('PUSER_PPAS', encryptedNaP);
        formData.append('PIP_ADD', ipDisp);
        formData.append('PDATA_DISPOSITIVO', dataDisp);
        console.log(url, "-", formData);
        return this.httpClient.post(url, formData, { headers: headers, responseType: "json" });
    };
    BankService.prototype.obtenerUltimoAcceso = function (encryptedSecuencia) {
        var url = this.baseUrl + "/GET_USER_INTRO_DATA";
        var headers = http_utils_1.HttpUtils.createRequestHeaderPost();
        var formData = new FormData();
        formData.append('PSECUENCIA', encryptedSecuencia);
        //console.log(url, "-", formData);
        return this.httpClient.post(url, formData, { headers: headers, responseType: "json" });
    };
    BankService.prototype.obtenerTiposDeCuentas = function (encryptedSecuencia) {
        var url = this.baseUrl + "/GET_TIPO_CUENTAS";
        var headers = http_utils_1.HttpUtils.createRequestHeaderPost();
        var formData = new FormData();
        formData.append('PSECUENCIA', encryptedSecuencia);
        //console.log(url, "-", formData);
        return this.httpClient.post(url, formData, { headers: headers, responseType: "json" });
    };
    // Ok Kinvey
    BankService.prototype.obtenerSucursales = function () {
        var url = this.baseUrl + "/GET_SUCURSALES";
        var headers = http_utils_1.HttpUtils.createRequestHeaderPost();
        console.log(url);
        return this.httpClient.post(url, "", { headers: headers, responseType: "json" });
    };
    BankService.prototype.obtenerSucursalesSecuencia = function (encryptedSecuencia) {
        var url = this.baseUrl + "/GET_SUCURSALES";
        var headers = http_utils_1.HttpUtils.createRequestHeaderPost();
        var formData = new FormData();
        formData.append('PSECUENCIA', encryptedSecuencia);
        console.log(url);
        return this.httpClient.post(url, formData, { headers: headers, responseType: "json" });
    };
    BankService.prototype.revisaBLStatus = function (encryptedSecuencia) {
        var url = this.baseUrl + "/GET_BL_STATUS";
        var headers = http_utils_1.HttpUtils.createRequestHeaderPost();
        var formData = new FormData();
        formData.append('PSECUENCIA', encryptedSecuencia);
        console.log(url, "-", formData);
        return this.httpClient.post(url, formData, { headers: headers, responseType: "json" })
            .map(function (res) {
            console.log("revisaBLStatus", JSON.stringify(res));
            var status = res["NewDataSet"]["Table"]["PESTADO"];
            return status;
        });
    };
    BankService = __decorate([
        core_1.Injectable(),
        __metadata("design:paramtypes", [http_1.HttpClient])
    ], BankService);
    return BankService;
}());
exports.BankService = BankService;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFuay5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYmFuay5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsc0NBQTJDO0FBQzNDLDZDQUFrRDtBQUNsRCxpQ0FBK0I7QUFFL0IseURBQXVEO0FBSXZEO0lBT0UscUJBQW9CLFVBQXVCO1FBQXZCLGVBQVUsR0FBVixVQUFVLENBQWE7UUFMM0MsbURBQW1EO1FBQ25ELGdGQUFnRjtRQUV4RSxZQUFPLEdBQVksc0JBQVMsQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUdoRCxDQUFDO0lBRUQsZ0NBQVUsR0FBVixVQUFXLFdBQVcsRUFBQyxNQUFNLEVBQUMsV0FBVztRQUN2QyxJQUFJLEdBQUcsR0FBTSxJQUFJLENBQUMsT0FBTyxpQkFBYyxDQUFDO1FBQ3hDLElBQUksT0FBTyxHQUFHLHNCQUFTLENBQUMsdUJBQXVCLEVBQUUsQ0FBQztRQUNsRCxJQUFJLFFBQVEsR0FBRyxJQUFJLFFBQVEsRUFBRSxDQUFDO1FBQzlCLFFBQVEsQ0FBQyxNQUFNLENBQUMsWUFBWSxFQUFFLFdBQVcsQ0FBQyxDQUFDO1FBQzNDLFFBQVEsQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBQ25DLFFBQVEsQ0FBQyxNQUFNLENBQUMsY0FBYyxFQUFFLFdBQVcsQ0FBQyxDQUFDO1FBQzdDLGdEQUFnRDtRQUNoRCxNQUFNLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLFFBQVEsRUFBRSxFQUFDLE9BQU8sRUFBQyxPQUFPLEVBQUMsWUFBWSxFQUFDLE1BQU0sRUFBQyxDQUFDLENBQUM7SUFDcEYsQ0FBQztJQUVELHFDQUFlLEdBQWYsVUFBZ0Isa0JBQWtCLEVBQUMsU0FBUyxFQUFDLFFBQVEsRUFBQyxJQUFJO1FBQ3hELElBQUksR0FBRyxHQUFNLElBQUksQ0FBQyxPQUFPLG9CQUFpQixDQUFDO1FBQzNDLElBQUksT0FBTyxHQUFHLHNC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RUFBQyxZQUFZLEVBQUMsTUFBTSxFQUFDLENBQUMsQ0FBQztJQUNsRixDQUFDO0lBRUQsb0NBQWMsR0FBZCxVQUFlLGtCQUFrQjtRQUMvQixJQUFJLEdBQUcsR0FBYSxJQUFJLENBQUMsT0FBTyxtQkFBZ0IsQ0FBQztRQUNqRCxJQUFJLE9BQU8sR0FBRyxzQkFBUyxDQUFDLHVCQUF1QixFQUFFLENBQUM7UUFDbEQsSUFBSSxRQUFRLEdBQUcsSUFBSSxRQUFRLEVBQUUsQ0FBQztRQUM5QixRQUFRLENBQUMsTUFBTSxDQUFDLFlBQVksRUFBRSxrQkFBa0IsQ0FBQyxDQUFDO1FBQ2xELE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxRQUFRLENBQUMsQ0FBQztRQUNoQyxNQUFNLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLFFBQVEsRUFBRSxFQUFDLE9BQU8sRUFBQyxPQUFPLEVBQUMsWUFBWSxFQUFDLE1BQU0sRUFBQyxDQUFDO2FBQ2hGLEdBQUcsQ0FBRSxVQUFDLEdBQUc7WUFDUixPQUFPLENBQUMsR0FBRyxDQUFDLGdCQUFnQixFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztZQUNuRCxJQUFJLE1BQU0sR0FBWSxHQUFHLENBQUMsWUFBWSxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDNUQsTUFBTSxDQUFDLE1BQU0sQ0FBQztRQUNoQixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFsS1UsV0FBVztRQUR2QixpQkFBVSxFQUFFO3lDQVFzQixpQkFBVTtPQVBoQyxXQUFXLENBcUt2QjtJQUFELGtCQUFDO0NBQUEsQUFyS0QsSUFxS0M7QUFyS1ksa0NBQVciLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcclxuaW1wb3J0IHsgSHR0cENsaWVudCB9IGZyb20gXCJAYW5ndWxhci9jb21tb24vaHR0cFwiO1xyXG5pbXBvcnQgXCJyeGpzL2FkZC9vcGVyYXRvci9tYXBcIjtcclxuXHJcbmltcG9ydCB7IEh0dHBVdGlscyB9IGZyb20gXCIuLi9zaGFyZWQvdXRpbHMvaHR0cC11dGlsc1wiO1xyXG5cclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIEJhbmtTZXJ2aWNlIHtcclxuXHJcbiAgLy8gcHJpdmF0ZSBiYXNlVXJsOnN0cmluZyA9IFwiaHR0cDovLzEwLjAuMi4yOjMwMDBcIjtcclxuICAvLyBwcml2YXRlIGJhc2VVcmw6c3RyaW5nID0gXCJodHRwOi8vMjE2LjI1MC4xMTQuMTA3OjgwODAvU3RHZW9yZ2VzQmFua1NlcnZpY2VzXCI7XHJcblxyXG4gIHByaXZhdGUgYmFzZVVybCA6IHN0cmluZyA9IEh0dHBVdGlscy5nZXRXc1VybCgpO1xyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGh0dHBDbGllbnQgOiBIdHRwQ2xpZW50KSB7XHJcbiAgfVxyXG5cclxuICBsb2dvdXRVc2VyKGVuY3J5cHRlU2VjLGlwQWRkcixyYXpvblNhbGlkYSl7XHJcbiAgICBsZXQgdXJsID0gYCR7dGhpcy5iYXNlVXJsfS9MT0dPVVRfVVNFUmA7XHJcbiAgICBsZXQgaGVhZGVycyA9IEh0dHBVdGlscy5jcmVhdGVSZXF1ZXN0SGVhZGVyUG9zdCgpO1xyXG4gICAgbGV0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XHJcbiAgICBmb3JtRGF0YS5hcHBlbmQoJ1BTRUNVRU5DSUEnLCBlbmNyeXB0ZVNlYyk7XHJcbiAgICBmb3JtRGF0YS5hcHBlbmQoJ1BJUF9BREQnLCBpcEFkZHIpO1xyXG4gICAgZm9ybURhdGEuYXBwZW5kKCdSQVpPTl9TQUxJREEnLCByYXpvblNhbGlkYSk7XHJcbiAgICAvL2NvbnNvbGUubG9nKFwibG9nb3V0VXNlcjpcIix1cmwsIFwiLVwiLCBmb3JtRGF0YSk7XHJcbiAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LnBvc3QodXJsLCBmb3JtRGF0YSwge2hlYWRlcnM6aGVhZGVycyxyZXNwb25zZVR5cGU6XCJqc29uXCJ9KTtcclxuICB9XHJcblxyXG4gIGNhbWJpYXJQYXNzd29yZChlbmNyeXB0ZWRVc3JQd2RTZWMsaW5kQ2FtYmlvLHZpZ2VuY2lhLGhhc2gpe1xyXG4gICAgbGV0IHVybCA9IGAke3RoaXMuYmFzZVVybH0vUkVTRVRfUEFTU1dPUkRgO1xyXG4gICAgbGV0IGhlYWRlcnMgPSBIdHRwVXRpbHMuY3JlYXRlUmVxdWVzdEhlYWRlclBvc3QoKTtcclxuICAgIGxldCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xyXG4gICAgZm9ybURhdGEuYXBwZW5kKCdQVVNFUl9QUEFTU05FV19QU0VDVUVOQ0lBJywgZW5jcnlwdGVkVXNyUHdkU2VjKTtcclxuICAgIGZvcm1EYXRhLmFwcGVuZCgnUElORF9DQU1CSU8nLCBpbmRDYW1iaW8pO1xyXG4gICAgZm9ybURhdGEuYXBwZW5kKCdQQ0FEVUNJREFEJywgdmlnZW5jaWEpO1xyXG4gICAgZm9ybURhdGEuYXBwZW5kKCdQSEFTSCcsIGhhc2gpO1xyXG4gICAgY29uc29sZS5sb2codXJsLCBcIi1cIiwgZm9ybURhdGEpO1xyXG4gICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5wb3N0KHVybCwgZm9ybURhdGEsIHtoZWFkZXJzOmhlYWRlcnMscmVzcG9uc2VUeXBlOlwianNvblwifSk7XHJcbiAgfVxyXG5cclxuICBvYnRlbmVyUHdkVmlnZW5jaWEoKXtcclxuICAgIGxldCB1cmwgPSBgJHt0aGlzLmJhc2VVcmx9L0dFVF9EVVJBQ0lPTl9DTEFWRWA7XHJcbiAgICBsZXQgaGVhZGVycyA9IEh0dHBVdGlscy5jcmVhdGVSZXF1ZXN0SGVhZGVyUG9zdCgpO1xyXG4gICAgbGV0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XHJcbiAgICAvL2NvbnNvbGUubG9nKHVybCwgXCItXCIsIGZvcm1EYXRhKTtcclxuICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnQucG9zdCh1cmwsIGZvcm1EYXRhLCB7aGVhZGVyczpoZWFkZXJzLHJlc3BvbnNlVHlwZTpcImpzb25cIn0pO1xyXG4gIH1cclxuXHJcbiAgdmFsaWRhclRva2VuKHNlY3VlbmNpYSx0b2tlbixjbGllbnRlRW5jcmlwdGFkbyxpcERpc3ApIHtcclxuICAgIGxldCB1cmwgPSBgJHt0aGlzLmJhc2VVcmx9L1ZBTElEQVRFX1RPS0VOYDtcclxuICAgIGxldCBoZWFkZXJzID0gSHR0cFV0aWxzLmNyZWF0ZVJlcXVlc3RIZWFkZXJQb3N0KCk7XHJcbiAgICBsZXQgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcclxuICAgIGZvcm1EYXRhLmFwcGVuZCgnUFNFQ1VFTkNJQScsIHNlY3VlbmNpYSk7XHJcbiAgICBmb3JtRGF0YS5hcHBlbmQoJ1BUT0tFTicsIHRva2VuKTtcclxuICAgIGZvcm1EYXRhLmFwcGVuZCgnUFVTRVInLCBjbGllbnRlRW5jcmlwdGFkbyk7XHJcbiAgICBmb3JtRGF0YS5hcHBlbmQoJ1BJUF9BREQnLCBpcERpc3ApO1xyXG4gICAgLy9jb25zb2xlLmxvZyh1cmwsIFwiLVwiLCBmb3JtRGF0YSk7XHJcbiAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LnBvc3QodXJsLCBmb3JtRGF0YSwge2hlYWRlcnM6aGVhZGVycyxyZXNwb25zZVR5cGU6XCJqc29uXCJ9KTtcclxuICB9XHJcblxyXG4gIC8vIFNlIGNyZe+/vSBudWV2byBzZXJ2aWNpbyBpbmRlcGVuZGllbnRlIDIyLzA4LzIwMTguXHJcbiAgLy8gQ3VhbmRvIHNlIGNhbWJpZSB0b2RvIGEgZXNlIG51ZXZvIHNlcnZpY2lvIChtZW5zYWplLnNlcnZpY2UudHMpLCBzZSBkZWJlIGVsaW1pbmFyIGVzdGUgbe+/vXRvZG8uXHJcbiAgb2J0ZW5lck1lbnNhamUoY29kaWdvKXtcclxuICAgIGxldCB1cmwgPSBgJHt0aGlzLmJhc2VVcmx9L0dFVF9NRU5TQUpFYDtcclxuICAgIGxldCBoZWFkZXJzID0gSHR0cFV0aWxzLmNyZWF0ZVJlcXVlc3RIZWFkZXJQb3N0KCk7XHJcbiAgICBsZXQgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcclxuICAgIGZvcm1EYXRhLmFwcGVuZCgnUFJFU1BfQ09EJywgY29kaWdvKTtcclxuICAgIC8vY29uc29sZS5sb2codXJsLCBcIi1cIiwgZm9ybURhdGEpO1xyXG4gICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5wb3N0KHVybCwgZm9ybURhdGEsIHtoZWFkZXJzOmhlYWRlcnMscmVzcG9uc2VUeXBlOlwianNvblwifSk7XHJcbiAgfVxyXG5cclxuICBvYnRlbmVyVGlwb0NsaWVudGUoZW5jcnlwdGVkVXNyTmFtZSkge1xyXG4gICAgbGV0IHVybCA9IGAke3RoaXMuYmFzZVVybH0vR0VUX1RJUE9fQ0xJRU5URWA7XHJcbiAgICBsZXQgaGVhZGVycyA9IEh0dHBVdGlscy5jcmVhdGVSZXF1ZXN0SGVhZGVyUG9zdCgpO1xyXG4gICAgbGV0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XHJcbiAgICBmb3JtRGF0YS5hcHBlbmQoJ1BVU0VSJywgZW5jcnlwdGVkVXNyTmFtZSk7XHJcbiAgICAvL2NvbnNvbGUubG9nKHVybCwgXCItXCIsIGZvcm1EYXRhKTtcclxuICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnQucG9zdCh1cmwsIGZvcm1EYXRhLCB7aGVhZGVyczpoZWFkZXJzLHJlc3BvbnNlVHlwZTpcImpzb25cIn0pO1xyXG4gIH1cclxuXHJcbiAgb2J0ZW5lclVzckltYWdlKGVuY3J5cHRlZFVzck5hbWUsbW9kdWx1cyxleHBvbmVudCkge1xyXG4gICAgbGV0IHVybCA9IGAke3RoaXMuYmFzZVVybH0vR0VUX1VTRVJfSU1BR0VgO1xyXG4gICAgbGV0IGhlYWRlcnMgPSBIdHRwVXRpbHMuY3JlYXRlUmVxdWVzdEhlYWRlclBvc3QoKTtcclxuICAgIGxldCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xyXG4gICAgICBmb3JtRGF0YS5hcHBlbmQoJ1BVU0VSJywgZW5jcnlwdGVkVXNyTmFtZSk7XHJcbiAgICAgIGZvcm1EYXRhLmFwcGVuZCgnUE1PRFVMVVMnLCBtb2R1bHVzKTtcclxuICAgICAgZm9ybURhdGEuYXBwZW5kKCdQRVhQT05FTlQnLCBleHBvbmVudCk7XHJcbiAgICBjb25zb2xlLmxvZyh1cmwsIFwiLVwiLCBmb3JtRGF0YSk7XHJcbiAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LnBvc3QodXJsLCBmb3JtRGF0YSwge2hlYWRlcnM6aGVhZGVycyxyZXNwb25zZVR5cGU6XCJqc29uXCJ9KTtcclxuICB9XHJcblxyXG4gIG9idGVuZXJVc3JJbWFnZW4oZW5jcnlwdGVkVXNyTmFtZSxlbmNyeXB0ZWRLZXlBRVMpIHtcclxuICAgIGxldCB1cmwgPSBgJHt0aGlzLmJhc2VVcmx9L0dFVF9VU0VSX0lNQUdFTmA7XHJcbiAgICBsZXQgaGVhZGVycyA9IEh0dHBVdGlscy5jcmVhdGVSZXF1ZXN0SGVhZGVyUG9zdCgpO1xyXG4gICAgbGV0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XHJcbiAgICAgIGZvcm1EYXRhLmFwcGVuZCgnUFVTRVInLCBlbmNyeXB0ZWRVc3JOYW1lKTtcclxuICAgICAgZm9ybURhdGEuYXBwZW5kKCdQRU5WSU8nLCBlbmNyeXB0ZWRLZXlBRVMpO1xyXG4gICAgY29uc29sZS5sb2codXJsLCBcIi1cIiwgZm9ybURhdGEpO1xyXG4gICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5wb3N0KHVybCwgZm9ybURhdGEsIHtoZWFkZXJzOmhlYWRlcnMscmVzcG9uc2VUeXBlOlwianNvblwifSk7XHJcbiAgfVxyXG5cclxuICBnZW5QZW1Qcml2YXRlS2V5KHhtbFByaXZhdGVLZXkpIHtcclxuICAgIGxldCB1cmwgPSBgJHt0aGlzLmJhc2VVcmx9L0dFTl9LRVlTYDtcclxuICAgIGxldCBoZWFkZXJzID0gSHR0cFV0aWxzLmNyZWF0ZVJlcXVlc3RIZWFkZXJQb3N0KCk7XHJcbiAgICBsZXQgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcclxuICAgICAgZm9ybURhdGEuYXBwZW5kKCdQSycsIHhtbFByaXZhdGVLZXkpO1xyXG4gICAgY29uc29sZS5sb2codXJsLCBcIi1cIiwgZm9ybURhdGEpO1xyXG4gICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5wb3N0KHVybCwgZm9ybURhdGEsIHtoZWFkZXJzOmhlYWRlcnMscmVzcG9uc2VUeXBlOlwianNvblwifSk7XHJcbiAgfVxyXG5cclxuXHJcbiAgdmFsaWRhclVzckxvZ2luKGVuY3J5cHRlZE5hUCxpcERpc3AsZGF0YURpc3Ape1xyXG4gICAgbGV0IHVybCA9IGAke3RoaXMuYmFzZVVybH0vVkFMSURBVEVfVVNFUl9QV0RfTE9HSU5gO1xyXG4gICAgbGV0IGhlYWRlcnMgPSBIdHRwVXRpbHMuY3JlYXRlUmVxdWVzdEhlYWRlclBvc3QoKTtcclxuICAgIGxldCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xyXG4gICAgZm9ybURhdGEuYXBwZW5kKCdQVVNFUl9QUEFTJywgZW5jcnlwdGVkTmFQKTtcclxuICAgIGZvcm1EYXRhLmFwcGVuZCgnUElQX0FERCcsIGlwRGlzcCk7XHJcbiAgICBmb3JtRGF0YS5hcHBlbmQoJ1BEQVRBX0RJU1BPU0lUSVZPJywgZGF0YURpc3ApO1xyXG4gICAgY29uc29sZS5sb2codXJsLCBcIi1cIiwgZm9ybURhdGEpO1xyXG4gICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5wb3N0KHVybCwgZm9ybURhdGEsIHtoZWFkZXJzOmhlYWRlcnMscmVzcG9uc2VUeXBlOlwianNvblwifSk7XHJcbiAgfVxyXG5cclxuICBvYnRlbmVyVWx0aW1vQWNjZXNvKGVuY3J5cHRlZFNlY3VlbmNpYSl7XHJcbiAgICBsZXQgdXJsID0gYCR7dGhpcy5iYXNlVXJsfS9HRVRfVVNFUl9JTlRST19EQVRBYDtcclxuICAgIGxldCBoZWFkZXJzID0gSHR0cFV0aWxzLmNyZWF0ZVJlcXVlc3RIZWFkZXJQb3N0KCk7XHJcbiAgICBsZXQgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcclxuICAgIGZvcm1EYXRhLmFwcGVuZCgnUFNFQ1VFTkNJQScsIGVuY3J5cHRlZFNlY3VlbmNpYSk7XHJcbiAgICAvL2NvbnNvbGUubG9nKHVybCwgXCItXCIsIGZvcm1EYXRhKTtcclxuICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnQucG9zdCh1cmwsIGZvcm1EYXRhLCB7aGVhZGVyczpoZWFkZXJzLHJlc3BvbnNlVHlwZTpcImpzb25cIn0pO1xyXG4gIH1cclxuXHJcbiAgb2J0ZW5lclRpcG9zRGVDdWVudGFzKGVuY3J5cHRlZFNlY3VlbmNpYSkge1xyXG4gICAgbGV0IHVybCA9IGAke3RoaXMuYmFzZVVybH0vR0VUX1RJUE9fQ1VFTlRBU2A7XHJcbiAgICBsZXQgaGVhZGVycyA9IEh0dHBVdGlscy5jcmVhdGVSZXF1ZXN0SGVhZGVyUG9zdCgpO1xyXG4gICAgbGV0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XHJcbiAgICBmb3JtRGF0YS5hcHBlbmQoJ1BTRUNVRU5DSUEnLCBlbmNyeXB0ZWRTZWN1ZW5jaWEpO1xyXG4gICAgLy9jb25zb2xlLmxvZyh1cmwsIFwiLVwiLCBmb3JtRGF0YSk7XHJcbiAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LnBvc3QodXJsLCBmb3JtRGF0YSwge2hlYWRlcnM6aGVhZGVycyxyZXNwb25zZVR5cGU6XCJqc29uXCJ9KTtcclxuICB9XHJcblxyXG4gIC8vIE9rIEtpbnZleVxyXG4gIG9idGVuZXJTdWN1cnNhbGVzKCl7XHJcbiAgICBsZXQgdXJsOnN0cmluZyA9IGAke3RoaXMuYmFzZVVybH0vR0VUX1NVQ1VSU0FMRVNgO1xyXG4gICAgbGV0IGhlYWRlcnMgPSBIdHRwVXRpbHMuY3JlYXRlUmVxdWVzdEhlYWRlclBvc3QoKTtcclxuICAgIGNvbnNvbGUubG9nKHVybCk7XHJcbiAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LnBvc3QodXJsLFwiXCIse2hlYWRlcnM6aGVhZGVycyxyZXNwb25zZVR5cGU6XCJqc29uXCJ9KTtcclxuICB9XHJcblxyXG4gIG9idGVuZXJTdWN1cnNhbGVzU2VjdWVuY2lhKGVuY3J5cHRlZFNlY3VlbmNpYSl7XHJcbiAgICBsZXQgdXJsOnN0cmluZyA9IGAke3RoaXMuYmFzZVVybH0vR0VUX1NVQ1VSU0FMRVNgO1xyXG4gICAgbGV0IGhlYWRlcnMgPSBIdHRwVXRpbHMuY3JlYXRlUmVxdWVzdEhlYWRlclBvc3QoKTtcclxuICAgIGxldCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xyXG4gICAgZm9ybURhdGEuYXBwZW5kKCdQU0VDVUVOQ0lBJywgZW5jcnlwdGVkU2VjdWVuY2lhKTtcclxuICAgIGNvbnNvbGUubG9nKHVybCk7XHJcbiAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LnBvc3QodXJsLGZvcm1EYXRhLHtoZWFkZXJzOmhlYWRlcnMscmVzcG9uc2VUeXBlOlwianNvblwifSk7XHJcbiAgfVxyXG5cclxuICByZXZpc2FCTFN0YXR1cyhlbmNyeXB0ZWRTZWN1ZW5jaWEpe1xyXG4gICAgbGV0IHVybDpzdHJpbmcgPSBgJHt0aGlzLmJhc2VVcmx9L0dFVF9CTF9TVEFUVVNgO1xyXG4gICAgbGV0IGhlYWRlcnMgPSBIdHRwVXRpbHMuY3JlYXRlUmVxdWVzdEhlYWRlclBvc3QoKTtcclxuICAgIGxldCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xyXG4gICAgZm9ybURhdGEuYXBwZW5kKCdQU0VDVUVOQ0lBJywgZW5jcnlwdGVkU2VjdWVuY2lhKTtcclxuICAgIGNvbnNvbGUubG9nKHVybCwgXCItXCIsIGZvcm1EYXRhKTtcclxuICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnQucG9zdCh1cmwsIGZvcm1EYXRhLCB7aGVhZGVyczpoZWFkZXJzLHJlc3BvbnNlVHlwZTpcImpzb25cIn0pXHJcbiAgICAubWFwKCAocmVzKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUubG9nKFwicmV2aXNhQkxTdGF0dXNcIiwgSlNPTi5zdHJpbmdpZnkocmVzKSk7XHJcbiAgICAgIGxldCBzdGF0dXMgOiBzdHJpbmcgPSByZXNbXCJOZXdEYXRhU2V0XCJdW1wiVGFibGVcIl1bXCJQRVNUQURPXCJdO1xyXG4gICAgICByZXR1cm4gc3RhdHVzO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuXHJcbn1cclxuIl19